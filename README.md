# Арифметический тренажёр

## Что это (коротко)
Перед вами локальный сервер приложения для тренировки арифметики. Сервер полностью написан на python, в качестве БД используется MySQL.

## Запуск
1. Настраиваем и включаем VPN
2. Качаем и устанавливаем [Docker desktop](https://www.docker.com/products/docker-desktop/)
3. Запускаем Docker desktop (VPN не выключаем)
4. Клонируем репозиторий
5. Открываем командную строку или Power shell
6. Переходим в папку, куда клонировали репозиторий командой *cd c:/your/git/dir*
7. Используем команду *docker-compose up -d*. Эта команда запускает процесс сборки стека из БД и сервера.
8. [test_request.py](test_request.py) - пробные запросы на локальный сервер http://localhost:5656

## Что это (подробно)
Сервер и БД разворачиваются в Docker. Сервер ждёт post-запросы на http://localhost, порт 5656.

Для авторизации при отправке запроса на сервер используется токен, посылаемый при запросе в заголовке Authorization.

Клиент и сервер взаимодействуют согласно внутреннего API, описанного в файле [API](API.md)

Для создания структуры таблиц и дальнейших миграций используется модуль **yoyo**.
Все миграции обрабатываются при запуске сервера.

Все запросы к БД написаны в явном виде и собраны в файле [sql_querys.py](modules/sql_querys.py).
### Таблицы
1. Пользователи (math_user). Содержит поля: id, имя, пароль, токен, email.
2. Примеры (math_tasks). Содержит поля: id, пример, решение, уровень сложности
3. Статистика (math_stat). Содержит поля: id, количество всего/правильных/неправильных ответов на примеры 4 уровней сложности (лёгкий, средний, сложный, собственный пример)
4. Достижения (math_achievements). Содержит поля: id, название, описание, размер (метрика выполнения)
5. Статистика достижений (math_achievements_stat). Содержит поля: id, light, hard - соответственно имеющимся достижениям. При добавлении достижения в таблицу math_achievements в таблице math_achievements_stat добавляются поля.

### Алгоритм работы сервера
1. Проверка и при необходимости выполнение миграций БД.
2. Проверка и при необходимости генерация таблицы с примерами. (заполнение 600 примерами, по 200 каждого уровня сложности)
3. Запуск сервера, ожидание запросов.

### Обработка запросов
1. Авторизация пользователя по токену
2. Обработка тела запроса. На вход фукнции-обработчика подаётся json определённого формата (см. [API](API.md))
3. Отправка ответа клиенту. На выходе функции обработчика также json.  
