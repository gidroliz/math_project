# API арифметического тренажёра
## Общие сведения
POST-запросы, заголовок «Authorization» содержит токен для верификации доступа. Токен генерирует сервер при регистрации пользователя.

Для отдельных запросов используем «захардкоженный» токен (далее «хард»-токен). Он хранится напрямую в коде клиента и сервера.

ХАРД-токен: LbyDaYQfoqWfYmTt
## Формат запроса клиента
Body запроса (json) должно содержать 2 пункта:
- сommand: команда, ключевое слово
- data: набор данных для данной команды
## Формат ответа сервера
статус-код: 200, 403

answer: набор данных (json) по текущему запросу

message (reason): сообщение, иллюстрирующее статус-код
## Описание запросов
### Получение БД с примерами для создания локальной копии
Запрос отправляется при первом запуске приложения для создания локальной копии базы примеров. Важно предусмотреть нотификацию пользователя, если у него отсутствует соединение с интернетом. Также на время обновления базы можно повесить прогресс-бар.

Для авторизации запроса используем «хард»-токен.

Формат ответа: массив массивов, каждый вложенный массив состоит из 3 элементов – текст примера, ответ, уровень сложности (от 0 до 2).

Запрос: _{“command”: ”get_all_tasks”, “data”: null}_

Ответ: _{“answer”: [[“1+2”,3,0],[“17*25-4”,421,1],[“11*(17-3/2)+3”, 173.5,2]]}_
### Регистрация
Запрос отправляется после нажатия пользователем кнопки «Зарегистрироваться», когда он уже ввёл свой логин, пароль, почту и т.п. Данные отправляются на сервер, проверяется, не занято ли имя, не зарегистрирован ли на данный email ещё пользователь. Если пользователь действительно новый, генерируется токен, отправляется клиенту.

**ВАЖНО!** Данный токен будет подписывать все запросы клиента серверу. Его надо хранить на девайсе.

Для авторизации запроса используем «хард»-токен.

**ВАЖНО.** Перед передачей пароль надо зашифровать через md5.

Запрос: _{“command”: ”new_user”, “data”: {“name”:”username”, “email”:”users_email”, “password”: ”users_pass”}}_

Ответ 200: _{“answer”: {“token”: “privateuserstoken”}}_

Ответ 403: _{“answer”: “error_message”}_
### Авторизация

Запрос отправляется после нажатия кнопки Войти на стартовом экране. Серверу отправляются данные пользователя, в ответ приходит токен.

Для авторизации запроса используем «хард»-токен.

**ВАЖНО.** Перед передачей пароль надо зашифровать через md5.

Запрос: _{“command”: ”authorization”, “data”: {“name”:”username”, “password”:”users_pass”}}_

Ответ 200: _{“answer”: {“token”: “privateuserstoken”}}_

Ответ 403: _{“answer”: “error_message”}_
### Получение лидер-бордов
Запрос отправляется при переходе пользователя на экран рейтингов.

Формат ответа: словарь, ключ – уровень сложности, значение – массив массивов, где каждый вложенный массив содержит имя пользователя и значение его прогресса. Данные отсортированы по убыванию.

Запрос: _{“command”: ”get_leaderboards”, “data”:null}_

Ответ 200: _{“answer”: {“0”: [[“Alex”, 100], [“Boris”, 99]], “1”: [[“Alex”, 100], [“Boris”, 99]], “2”: [[“Alex”, 100], [“Boris”, 99]]}}_

Ответ 403: _{“answer”: “error_message”}_
### Получение одного примера
Отправляется, когда пользователь запрашивает новый пример. Если пользователь выбрал стандартный уровень сложности, то hard присваиваем 0, 1 или 2. Если пример генерируется с использованием фильтров, то hard = “custom” и добавляем параметры фильтра: min и max – целые числа, operators – список знаков, numofoperands (количество операндов) – целое число >=2, brackets (наличие скобок) – булево значение.

Формат ответа: массив из текста примера и ответа.

Запрос стандартного примера: _{“command”: ”get_task”, “data”: {“hard”: 1}}_

Запрос примера с фильтрами: _{“command”: ”get_task”, “data”: {“hard”: “custom”, “min”: -10, “max”: 50, “operators”: [“+”,”-”], “numofoperands”: 5, “brackets”: true}}_

Ответ 200: _{“answer”: [“2*(3+4-5)/6”, 0.67]}_

Ответ 403: _{“answer”: “error_message”}_

### Отчёт о правильном ответе

Когда пользователь проверяет ответ, и ответ оказывается верным, на сервер отправляется запрос для подсчёта статистики. В запрос включаем уровень сложности примера (0, 1, 2, custom).

Запрос: _{“command”: ”correct_solution”, “data”: 0}_

Ответ 200: _{“answer”: “counted”}_

Ответ 403: _{“answer”: “error_message”}_

### Отчёт о неправильном ответе

Когда пользователь проверяет ответ, и ответ оказывается неверным, на сервер отправляется запрос для подсчёта статистики. В запрос включаем уровень сложности примера (0, 1, 2, custom).

Запрос: _{“command”: ” wrong_solution”, “data”: “custom”}_

Ответ 200: _{“answer”: “counted”}_

Ответ 403: _{“answer”: “error_message”}_

### Инкрементный счётчик примеров

Когда пользователь запрашивает новый пример, на сервер отправляется запрос для подсчёта статистики. В запрос включаем уровень сложности примера (0, 1, 2, custom).

Запрос: _{“command”: “counter”, “data”: 2}_

Ответ 200: _{“answer”: “counted”}_

Ответ 403: _{“answer”: “error_message”}_

### Получение достижений

Запрос отправляется при переходе пользователя на экран достижений.

Формат ответа: словарь, ключ – название достижения, значение – словарь, содержащий прогресс пользователя и параметры достижения. Параметры достижения: size – значение, при котором засчитывается достижение, description – описание достижения.

Запрос: {“command”: ”get_achievements”, “data”: null}

Ответ 200: _{“answer”: {“light”: {“progress”: 10, “size”: 100, “description”: “Реши 100 примеров на лёгком уровне сложности.”}, {“hard”: {“progress”: 0, “size”: 100, “description”: “Реши 100 сложных примеров.”}}}}_

Ответ 403: _{“answer”: “error_message”}_
